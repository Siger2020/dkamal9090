# دليل إعادة تعيين النظام وحذف البيانات التجريبية

## نظرة عامة

تم إضافة ميزة جديدة لإدارة البيانات التجريبية وإعادة تعيين النظام في عيادة الدكتور كمال الملصي لطب الأسنان.

## الميزات الجديدة

### 1. صفحة إعادة تعيين النظام (`/system-reset`)

صفحة مخصصة لإدارة البيانات التجريبية مع خيارين رئيسيين:

#### أ) حذف البيانات التجريبية
- **الوصف**: حذف البيانات التجريبية المحددة مسبقاً فقط
- **يتم حذف**:
  - حساب المدير (admin@dkalmoli.com)
  - المستخدمين التجري��يين
  - المرضى التجريبيين
  - الأطباء التجريبيين
  - المواعيد التجريبية
  - المعاملات المالية التجريبية

#### ب) إعادة تهيئة قاعدة البيانات
- **الوصف**: حذف جميع البيانات وإعادة تهيئة النظام بالكامل
- **تحذير**: عملية غير قابلة للتراجع
- **يتم حذف**: جميع البيانات في النظام

### 2. نقاط النهاية الجديدة في API

#### `DELETE /api/auth/reset-admin`
- حذف البيانات التجريبية للمدير والمستخدمين
- إرجاع تفاصيل حول عدد السجلات المحذوفة

#### `POST /api/auth/reset-database`
- إعادة تهيئة قاعدة البيانات بالكامل
- تعطيل مؤقت لقيود المفاتيح الخارجية
- إعادة تعيين تسلسل AUTO_INCREMENT

### 3. التكامل مع صفحة الإدارة

- إضافة بطاقة "إعادة تعيين النظام" في تبويب النظرة العامة
- إضافة رابط في قسم الإعدادات
- واجهة سهلة الاستخدام مع تحذيرات واضحة

## كيفية الاستخدام

### للوصول إلى الميزة:

1. **من صفحة الإدارة الرئيسية**:
   - انتقل إلى `/admin`
   - في تبويب "النظرة العامة"، ستجد بطاقة "إعادة تعيين النظام"
   - اضغط على "إدارة إعادة التعيين"

2. **من قسم الإعدادات**:
   - انتقل إلى تبويب "الإعدادات" في صفحة الإدارة
   - اضغط على "إعادة تعيين النظام"

3. **الوصول المباشر**:
   - انتقل مباشرة إلى `/system-reset`

### خطوات حذف البيانات التجريبية:

1. انتقل إلى صفحة إعادة تعيين النظام
2. اختر "حذف البيانات التجريبية"
3. اقرأ التحذير بعناية
4. اضغط على "نعم، احذف البيانات"
5. ستظهر رسالة تأكيد بتفاصيل العملية

### خطوات إعادة تهيئة قاعدة البيانات:

1. انتقل إلى صفحة إعادة تعيين النظام
2. اختر "إعادة تهيئة قاعدة البيانات"
3. **تحذير**: اقرأ التحذير بعناية فائقة
4. اضغط على "نعم، أعد تهيئة قاعدة البيانات"
5. ستظهر رسالة تأكيد بتفاصيل العملية

## الأمان والحماية

### التحقق من الصلاحيات
- تتطلب صلاحيات مدير النظام (`admin`)
- حماية بواسطة `ProtectedRoute`

### تأكيدات متعددة
- نافذة تأكيد قبل تنفيذ أي عملية حذف
- تحذيرات واضحة حول عدم إمكانية التراجع
- ألوان مختلفة للتمييز بين مستويات الخطورة

### معالجة الأخطاء
- معالجة شاملة للأخطاء
- رسائل خطأ واضحة ومفهومة
- تسجيل مفصل في وحدة التحكم

## المتطلبات التقنية

### الاعتمادات الجديدة
- لا توجد اعتمادات خارجية جديدة
- استخدام مكونات UI الموجودة

### الملفات المحدثة
```
client/pages/SystemReset.tsx (جديد)
client/pages/Admin.tsx (محدث)
client/App.tsx (محدث)
server/routes/auth.ts (محدث)
```

### قاعدة البيانات
- عمليات حذف آمنة مع معالجة foreign keys
- إعادة تعيين تسلسل AUTO_INCREMENT
- تسجيل تفصيلي للعمليات

## حالات الاستخدام

### متى تستخدم حذف البيانات التجريبية:
- ✅ عند الانتهاء من اختبار النظام
- ✅ قبل البدء في استخدام النظام مع بيانات حقيقية
- ✅ عندما تريد البدء بحساب مدير جديد
- ✅ لإزالة البيانات الوهمية فقط

### متى تستخدم إعادة تهيئة قاعدة البيانات:
- ⚠️ عند الحاجة لمسح جميع البيانات والبدء من جديد
- ⚠️ في حالة وجود مشاكل في البيانات
- ⚠️ عند إعادة تعيين النظام لمستخدم جديد
- ⚠️ لحل مشاكل تطابق البيانات

## الاستجابة المتوقعة

### نجح حذف البيانات التجريبية:
```json
{
  "success": true,
  "message": "تم حذف جميع البيانات التجريبية بنجاح",
  "details": {
    "adminDeleted": 1,
    "testUsersDeleted": 5,
    "totalRecordsDeleted": 12
  }
}
```

### نجحت إعادة تهيئة قاعدة البيانات:
```json
{
  "success": true,
  "message": "تم إعادة تهيئة قاعدة البيانات بنجاح",
  "details": {
    "totalRecordsDeleted": 50,
    "tablesReset": 15
  }
}
```

## نصائح مهمة

### قبل تنفيذ أي عملية حذف:
1. **إنشاء نسخة احتياطية** من البيانات المهمة
2. **التأكد من ��دم الحاجة** للبيانات الحالية
3. **إبلاغ جميع المستخدمين** قبل إعادة التهيئة
4. **اختبار العملية** في بيئة اختبار أولاً

### بعد تنفيذ العملية:
1. **تحقق من نجاح العملية** من خلال الرسائل
2. **أعد تشغيل الخادم** إذا لزم الأمر
3. **تحقق من سلامة البيانات** المتبقية
4. **أنشئ حسابات جديدة** حسب الحاجة

## الدعم والمساعدة

في حالة وجود أي مشاكل أو أسئلة حول استخدام هذه الميزة:

1. تحقق من سجلات الخادم (logs)
2. تأكد من صلاحيات المستخدم
3. تحقق من اتصال قاعدة البيانات
4. راجع رسائل الخطأ في واجهة المستخدم

---

**تحديث**: تم إنشاء هذه الميزة في إطار تحسين نظام إدارة عيادة الدكتور كمال الملصي لطب الأسنان.
